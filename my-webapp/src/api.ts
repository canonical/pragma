// Generated by summon webapp
// Feature module: api

/**
 * API client for my-webapp
 */
import ky from 'ky';

const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://api.example.com';

export const api = ky.create({
  prefixUrl: API_BASE_URL,
  timeout: 30000,
  retry: {
    limit: 2,
    methods: ['get'],
  },
  hooks: {
    beforeRequest: [
      (request) => {
        // Add auth token if available
        const token = localStorage.getItem('auth_token');
        if (token) {
          request.headers.set('Authorization', `Bearer ${token}`);
        }
      },
    ],
    afterResponse: [
      async (request, options, response) => {
        if (!response.ok) {
          console.error(`API Error: ${response.status} ${response.statusText}`);
        }
        return response;
      },
    ],
  },
});

// Typed API helpers
export async function get<T>(endpoint: string): Promise<T> {
  return api.get(endpoint).json<T>();
}

export async function post<T, D = unknown>(endpoint: string, data: D): Promise<T> {
  return api.post(endpoint, { json: data }).json<T>();
}

export async function put<T, D = unknown>(endpoint: string, data: D): Promise<T> {
  return api.put(endpoint, { json: data }).json<T>();
}

export async function del<T>(endpoint: string): Promise<T> {
  return api.delete(endpoint).json<T>();
}
